{% extends 'base.html' %}
{% load static %}

{% block title %}Available Properties{% endblock %}

{% block content %}
<h2>Property Listings</h2>

<!-- Filter form -->
<form method="GET" id="filter-form">
    <input type="text" name="title" placeholder="Title" value="{{ title }}">
    <input type="text" name="location" placeholder="Location" value="{{ location }}">
    <input type="number" name="min_price" placeholder="Min Price" value="{{ min_price }}">
    <input type="number" name="max_price" placeholder="Max Price" value="{{ max_price }}">

    <button type="submit">Filter</button>

    <select name="sort" id="sort-select" onchange="document.getElementById('filter-form').submit();">
        <option value="">Sort By</option>
        <option value="price_asc" {% if sort_option == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
        <option value="price_desc" {% if sort_option == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
        <option value="location_asc" {% if sort_option == 'location_asc' %}selected{% endif %}>Location: A-Z</option>
        <option value="available" {% if sort_option == 'available' %}selected{% endif %}>Availability</option>
    </select>
</form>

<!-- Add Property Button below the search bar -->
{% if user.is_authenticated %}
    <form method="GET" action="{% url 'properties:property_create' %}" style="text-align: center; margin-top: 20px;">
        <button type="submit" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
            Add Property
        </button>
    </form>
{% endif %}

<div class="property-grid">
    {% for property in properties %}
        <div class="property-item">
            {% if property.image %}
                <img src="{{ property.image.url }}" alt="{{ property.title }}" style="width: 100%; height: auto;">
            {% endif %}
            <h3>{{ property.title }}</h3>
            <p>Location: {{ property.location }}</p>
            <p>Price: ${{ property.price }}</p>
            <p>Status: {{ property.available }}</p>

            <a href="{% url 'properties:property_detail' property.pk %}">View Details</a>

            <!-- Edit and Delete functionality for property owners -->
            {% if user.is_authenticated and property.owner == user %}
                <a href="{% url 'properties:property_update' property.pk %}" style="color: blue;">Edit</a>
                <form action="{% url 'properties:property_delete' property.pk %}" method="POST" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" style="color: red; background: none; border: none; cursor: pointer;">Delete</button>
                </form>
            {% endif %}
        </div>
    {% empty %}
        <p>No properties found.</p>
    {% endfor %}
</div>

{% endblock %}
